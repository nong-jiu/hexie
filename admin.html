<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ•™å•ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .login-form {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-form input {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin: 0 10px;
            font-size: 16px;
            width: 200px;
        }
        
        .login-form button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .login-form button:hover {
            background: #5a6fd8;
        }
        
        .admin-panel {
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        textarea {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }
        
        textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: #5a6169;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
            flex: 1;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .preview-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .order-preview {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .help-text {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•è¡¨å• -->
        <div class="login-form" id="loginForm">
            <h1>ğŸ” ç®¡ç†å‘˜ç™»å½•</h1>
            <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å¯†ç " />
            <button onclick="login()">ç™»å½•</button>
        </div>
        
        <!-- ç®¡ç†é¢æ¿ -->
        <div class="admin-panel" id="adminPanel">
            <h1>ğŸ“‹ å®¶æ•™å•ç®¡ç†ç³»ç»Ÿ</h1>
            
            <div class="stats" id="statsContainer">
                <div class="stat-card">
                    <div class="stat-number" id="totalOrders">0</div>
                    <div class="stat-label">æ€»è®¢å•æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lastUpdate">æœªæ›´æ–°</div>
                    <div class="stat-label">æœ€åæ›´æ–°</div>
                </div>
            </div>
            
            <div class="help-text">
                <strong>ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                1. å°†å®¶æ•™å•æ•°æ®å¤åˆ¶ç²˜è´´åˆ°ä¸‹æ–¹æ–‡æœ¬æ¡†ä¸­<br>
                2. æ¯ä¸ªè®¢å•ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”<br>
                3. ç‚¹å‡»"è§£æé¢„è§ˆ"æ£€æŸ¥æ•°æ®æ ¼å¼<br>
                4. ç¡®è®¤æ— è¯¯åç‚¹å‡»"æ›´æ–°ç½‘ç«™æ•°æ®"<br>
                5. <strong>ğŸ‰ ç½‘ç«™å°†ç«‹å³å®æ—¶æ›´æ–°ï¼Œæ— éœ€ä¸‹è½½æ–‡ä»¶ï¼</strong>
            </div>
            
            <div class="form-group">
                <label for="orderData">ç²˜è´´å®¶æ•™å•æ•°æ®ï¼š</label>
                <textarea id="orderData" placeholder="è¯·å°†å®¶æ•™å•æ•°æ®ç²˜è´´åˆ°è¿™é‡Œ...

ç¤ºä¾‹æ ¼å¼ï¼š
æš‘å‡å•
ã€è®¢å•ï¼š25071206xã€‘
å®¶é•¿ç§°å‘¼ï¼š
å­©å­å¹´çº§ï¼šå‡†é«˜äºŒ
ç§‘ç›®ï¼šæ•°å­¦
æˆç»©ï¼š50-70
å­©å­æ€§åˆ«ï¼šç”·
è¯¾é…¬ï¼š300/æ—¶ 600/æ¬¡
è€å¸ˆæ€§åˆ«ï¼šä¸é™
å¯¹è€å¸ˆçš„è¦æ±‚ï¼šä¸“èŒè€å¸ˆ
æ¬¡æ•°ï¼šå¾…å®š
è¾…å¯¼æ—¶é—´ï¼šæš‘å‡7ã€8æœˆä¸Šè¯¾ï¼Œæ¯æ¬¡è¯¾ä¸¤å°æ—¶ï¼ˆå‘¨äºŒä¸‹åˆè¯•è¯¾ï¼‰
ä¸Šé—¨åœ°å€ï¼šå—å±±åŒº12å·çº¿ä¸­å±±å…¬å›­Aå‡ºå£

ã€è®¢å•ï¼š25071205aã€‘
å®¶é•¿ç§°å‘¼ï¼šæå…ˆç”Ÿ
..."></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn-secondary" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
                <button class="btn-primary" onclick="parseData()">è§£æé¢„è§ˆ</button>
                <button class="btn-success" onclick="updateWebsite()">æ›´æ–°ç½‘ç«™æ•°æ®</button>
            </div>
            
            <div id="statusMessage"></div>
            
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3>ğŸ“‹ è§£æç»“æœé¢„è§ˆ</h3>
                <div id="previewContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // ç®¡ç†å‘˜å¯†ç  (å¯ä»¥ä¿®æ”¹)
        const ADMIN_PASSWORD = 'mdjj2024';
        
        let parsedOrders = [];
        
        // ç™»å½•éªŒè¯
        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                loadStats();
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        function loadStats() {
            const currentData = localStorage.getItem('tutorOrders');
            const orders = currentData ? JSON.parse(currentData) : [];
            const lastUpdate = localStorage.getItem('lastUpdate') || 'æœªæ›´æ–°';
            
            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('lastUpdate').textContent = lastUpdate;
        }
        
        // æ¸…ç©ºæ•°æ®
        function clearData() {
            document.getElementById('orderData').value = '';
            document.getElementById('previewSection').style.display = 'none';
            showMessage('æ•°æ®å·²æ¸…ç©º', 'info');
        }
        
        // è§£ææ•°æ®
        function parseData() {
            const rawData = document.getElementById('orderData').value.trim();
            if (!rawData) {
                showMessage('è¯·å…ˆè¾“å…¥å®¶æ•™å•æ•°æ®', 'error');
                return;
            }
            
            try {
                parsedOrders = parseOrderData(rawData);
                if (parsedOrders.length > 0) {
                    showPreview(parsedOrders);
                    showMessage(`æˆåŠŸè§£æ ${parsedOrders.length} ä¸ªè®¢å•`, 'success');
                } else {
                    showMessage('æœªèƒ½è§£æåˆ°æœ‰æ•ˆè®¢å•æ•°æ®ï¼Œè¯·æ£€æŸ¥æ ¼å¼', 'error');
                }
            } catch (error) {
                showMessage('è§£æå¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // è§£æè®¢å•æ•°æ®
        function parseOrderData(rawData) {
            const orders = [];
            const blocks = rawData.split(/\n\s*\n/).filter(block => block.trim());
            
            for (const block of blocks) {
                const lines = block.split('\n').map(line => line.trim()).filter(line => line);
                const order = {};
                
                // è§£ææ¯ä¸€è¡Œ
                for (const line of lines) {
                    if (line.includes('ã€è®¢å•ï¼š') && line.includes('ã€‘')) {
                        order.id = line.match(/ã€è®¢å•ï¼š(.+?)ã€‘/)?.[1] || '';
                    } else if (line.startsWith('å®¶é•¿ç§°å‘¼ï¼š')) {
                        order.parentName = line.replace('å®¶é•¿ç§°å‘¼ï¼š', '').trim();
                    } else if (line.startsWith('å­©å­å¹´çº§ï¼š')) {
                        let grade = line.replace('å­©å­å¹´çº§ï¼š', '').trim();
                        if (grade.startsWith('å‡†')) {
                            grade = grade.substring(1);
                        }
                        order.grade = grade;
                    } else if (line.startsWith('ç§‘ç›®ï¼š')) {
                        order.subject = line.replace('ç§‘ç›®ï¼š', '').trim();
                    } else if (line.startsWith('æˆç»©ï¼š')) {
                        order.score = line.replace('æˆç»©ï¼š', '').trim();
                    } else if (line.startsWith('å­©å­æ€§åˆ«ï¼š')) {
                        order.studentGender = line.replace('å­©å­æ€§åˆ«ï¼š', '').trim();
                    } else if (line.startsWith('è¯¾é…¬ï¼š')) {
                        order.salary = line.replace('è¯¾é…¬ï¼š', '').trim();
                    } else if (line.startsWith('è€å¸ˆæ€§åˆ«ï¼š')) {
                        order.teacherGender = line.replace('è€å¸ˆæ€§åˆ«ï¼š', '').trim();
                    } else if (line.startsWith('å¯¹è€å¸ˆçš„è¦æ±‚ï¼š')) {
                        order.requirements = line.replace('å¯¹è€å¸ˆçš„è¦æ±‚ï¼š', '').trim();
                    } else if (line.startsWith('æ¬¡æ•°ï¼š')) {
                        order.frequency = line.replace('æ¬¡æ•°ï¼š', '').trim();
                    } else if (line.startsWith('è¾…å¯¼æ—¶é—´ï¼š')) {
                        order.time = line.replace('è¾…å¯¼æ—¶é—´ï¼š', '').trim();
                    } else if (line.startsWith('ä¸Šé—¨åœ°å€ï¼š')) {
                        order.address = line.replace('ä¸Šé—¨åœ°å€ï¼š', '').trim();
                        // è‡ªåŠ¨è¯†åˆ«åœ°åŒº
                        order.region = extractRegion(order.address);
                    }
                }
                
                // æ–°å¢ï¼šæ ¹æ®å¹´çº§è‡ªåŠ¨åˆ†ç±»
                order.gradeCategory = autoClassifyGrade(order.grade || '');

                // æ–°å¢ï¼šæ ¹æ®è¦æ±‚è‡ªåŠ¨åˆ†ç±»è€å¸ˆç±»å‹
                order.teacherType = [];
                const reqText = order.requirements || '';
                if (/å¤§å­¦ç”Ÿ|å¤§å­¦|ç ”ç©¶ç”Ÿ/.test(reqText)) {
                    order.teacherType.push('å¤§å­¦ç”Ÿ');
                }
                if (/ä¸“èŒ|åœ¨æ ¡|æœºæ„/.test(reqText)) {
                    order.teacherType.push('ä¸“èŒè€å¸ˆ');
                }

                // è‡ªåŠ¨åˆ†ç±»
                order.category = autoClassify(order);
                
                if (order.id) {
                    orders.push(order);
                }
            }
            
            return orders;
        }
        
        // æå–åœ°åŒºä¿¡æ¯
        function extractRegion(address) {
            const regions = ['ç¦ç”°åŒº', 'ç½—æ¹–åŒº', 'ç›ç”°åŒº', 'å—å±±åŒº', 'å®å®‰åŒº', 'é¾™å²—åŒº', 'é¾™ååŒº', 'åªå±±åŒº', 'å…‰æ˜åŒº', 'å¤§é¹æ–°åŒº'];
            for (const region of regions) {
                if (address.includes(region)) {
                    return region;
                }
            }
            return 'å…¶ä»–å¤§äºšæ¹¾åŒº';
        }

        // æ–°å¢ï¼šè‡ªåŠ¨åˆ†ç±»å¹´çº§
        function autoClassifyGrade(grade) {
            if (/å¹¼å„¿å›­|å¹¼å„¿|å¤§ç­|ä¸­ç­|å°ç­/.test(grade)) return 'å¹¼å„¿';
            if (/ä¸€å¹´çº§|äºŒå¹´çº§|ä¸‰å¹´çº§|å››å¹´çº§|äº”å¹´çº§|å…­å¹´çº§|å°å­¦|1å¹´çº§|2å¹´çº§|3å¹´çº§|4å¹´çº§|5å¹´çº§|6å¹´çº§/.test(grade)) return 'å°å­¦';
            if (/åˆä¸­|åˆä¸€|å…«å¹´çº§|ä¹å¹´çº§|åˆäºŒ|åˆä¸‰|7å¹´çº§|8å¹´çº§|9å¹´çº§/.test(grade)) return 'åˆä¸­';
            if (/é«˜ä¸­|é«˜ä¸€|é«˜äºŒ|é«˜ä¸‰|åå¹´çº§/.test(grade)) return 'é«˜ä¸­';
            if (/å¤§å­¦ç”Ÿ|æˆäºº|æˆå¹´äºº/.test(grade)) return 'æˆäºº';
            return ''; // é»˜è®¤æ— åˆ†ç±»
        }
        
        // è‡ªåŠ¨åˆ†ç±»
        function autoClassify(order) {
            const categories = [];
            
            // åŸºç¡€åˆ†ç±»
            categories.push('latest');
            
            // æ ¹æ®è¯¾é…¬åˆ¤æ–­é«˜ä»·å•
            if (order.salary && (order.salary.includes('300') || order.salary.includes('350') || order.salary.includes('400'))) {
                categories.push('high-price');
            }
            
            // æ ¹æ®æ—¶é—´åˆ¤æ–­ç±»å‹
            if (order.time) {
                if (order.time.includes('æš‘å‡') || order.time.includes('å¯’å‡')) {
                    categories.push('summer');
                }
                if (order.time.includes('å‘¨æœ«') || order.time.includes('å‘¨å…­') || order.time.includes('å‘¨æ—¥')) {
                    categories.push('weekend');
                }
                if (order.time.includes('æ™šä¸Š') || order.time.includes('æ™š')) {
                    categories.push('evening');
                }
                if (order.time.includes('å‘¨ä¸€') && order.time.includes('å‘¨äº”')) {
                    categories.push('daily');
                }
            }
            
            // æ ¹æ®è¦æ±‚åˆ¤æ–­åŠ æ€¥å•
            if (order.requirements && (order.requirements.includes('æ€¥') || order.requirements.includes('é©¬ä¸Š'))) {
                categories.push('urgent');
            }
            
            return categories;
        }
        
        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview(orders) {
            const container = document.getElementById('previewContainer');
            container.innerHTML = '';
            
            orders.forEach((order, index) => {
                const preview = document.createElement('div');
                preview.className = 'order-preview';
                preview.innerHTML = `
                    <strong>è®¢å• ${index + 1}ï¼š${order.id}</strong><br>
                    å¹´çº§ï¼š${order.grade || 'æœªå¡«å†™'} | ç§‘ç›®ï¼š${order.subject || 'æœªå¡«å†™'} | è¯¾é…¬ï¼š${order.salary || 'æœªå¡«å†™'}<br>
                    åœ°åŒºï¼š${order.region || 'æœªè¯†åˆ«'} | åˆ†ç±»ï¼š${order.category.join(', ')}
                `;
                container.appendChild(preview);
            });
            
            document.getElementById('previewSection').style.display = 'block';
        }
        
        // æ›´æ–°ç½‘ç«™æ•°æ®
        function updateWebsite() {
            if (parsedOrders.length === 0) {
                showMessage('è¯·å…ˆè§£ææ•°æ®', 'error');
                return;
            }
            
            try {
                // ä¿å­˜åˆ° localStorage
                localStorage.setItem('tutorOrders', JSON.stringify(parsedOrders));
                localStorage.setItem('lastUpdate', new Date().toLocaleString('zh-CN'));
                
                // è§¦å‘ä¸»é¡µé¢å®æ—¶æ›´æ–°
                triggerMainPageUpdate();
                
                showMessage(`âœ… æˆåŠŸæ›´æ–° ${parsedOrders.length} ä¸ªè®¢å•åˆ°ç½‘ç«™ï¼ç½‘ç«™æ•°æ®å·²å®æ—¶æ›´æ–°`, 'success');
                loadStats();
                
                // 3ç§’åå¯é€‰æ‹©è·³è½¬åˆ°ä¸»é¡µ
                setTimeout(() => {
                    if (confirm('æ•°æ®æ›´æ–°æˆåŠŸï¼æ˜¯å¦è·³è½¬åˆ°ä¸»é¡µæŸ¥çœ‹æ•ˆæœï¼Ÿ')) {
                        window.open('./index.html', '_blank');
                    }
                }, 1000);
                
            } catch (error) {
                showMessage('æ›´æ–°å¤±è´¥ï¼š' + error.message, 'error');
            }
        }
        
        // è§¦å‘ä¸»é¡µé¢æ›´æ–°
        function triggerMainPageUpdate() {
            // æ–¹æ³•1: è§¦å‘storageäº‹ä»¶ï¼ˆå¦‚æœåœ¨åŒä¸€ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µä¸­ï¼‰
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'tutorOrders',
                newValue: localStorage.getItem('tutorOrders'),
                url: window.location.href
            }));
            
            // æ–¹æ³•2: ä½¿ç”¨BroadcastChannel APIï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('tutor-orders-update');
                channel.postMessage({
                    type: 'data-updated',
                    count: parsedOrders.length,
                    timestamp: new Date().toISOString()
                });
                channel.close();
            }
            
            // æ–¹æ³•3: ä½¿ç”¨postMessageï¼ˆå¦‚æœé¡µé¢åœ¨iframeä¸­ï¼‰
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'tutor-orders-updated',
                    count: parsedOrders.length
                }, '*');
            }
        }
        
        // æ›´æ–°ä¸»ç½‘ç«™æ•°æ®
        function updateMainSiteData(orders) {
            // ç”±äºæ˜¯é™æ€ç½‘ç«™ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹ script.js çš„æ–¹å¼æ¥æ›´æ–°æ•°æ®
            const jsContent = generateUpdatedJavaScript(orders);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥è®©ç”¨æˆ·ä¸‹è½½æ›´æ–°åçš„ script.js
            const blob = new Blob([jsContent], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'script.js';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ç”Ÿæˆæ›´æ–°åçš„JavaScriptä»£ç 
        function generateUpdatedJavaScript(orders) {
            const orderDataString = JSON.stringify(orders, null, 4);
            
            return `// å®¶æ•™è®¢å•æ•°æ® - ç”±ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆäº ${new Date().toLocaleString('zh-CN')}
const orderData = ${orderDataString};

// å…¨å±€å˜é‡
let filteredData = orderData;
let currentCategory = 'all';

// DOMå…ƒç´ 
const orderList = document.getElementById('orderList');
const regionFilter = document.getElementById('regionFilter');
const gradeFilter = document.getElementById('gradeFilter');
const subjectFilter = document.getElementById('subjectFilter');
const orderSearch = document.getElementById('orderSearch');
const tabBtns = document.querySelectorAll('.tab-btn');

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    renderOrders(orderData);
    bindEvents();
});

// ç»‘å®šäº‹ä»¶
function bindEvents() {
    // ç­›é€‰å™¨äº‹ä»¶
    regionFilter.addEventListener('change', filterOrders);
    gradeFilter.addEventListener('change', filterOrders);
    subjectFilter.addEventListener('change', filterOrders);
    orderSearch.addEventListener('input', filterOrders);
    
    // åˆ†ç±»æ ‡ç­¾äº‹ä»¶
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // æ›´æ–°æ´»è·ƒçŠ¶æ€
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            currentCategory = this.dataset.category;
            filterOrders();
        });
    });
}

// æ¸²æŸ“è®¢å•åˆ—è¡¨
function renderOrders(orders) {
    if (!orders || orders.length === 0) {
        orderList.innerHTML = '<div class="empty-state">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è®¢å•</div>';
        return;
    }
    
    const ordersHtml = orders.map(order => createOrderCard(order)).join('');
    orderList.innerHTML = ordersHtml;
    
    // ç»‘å®šå¤åˆ¶æŒ‰é’®äº‹ä»¶
    bindCopyEvents();
}

// åˆ›å»ºè®¢å•å¡ç‰‡
function createOrderCard(order) {
    const tags = getOrderTags(order);
    
    return \`
        <div class="order-card" data-id="\${order.id}">
            <div class="order-header">
                <div class="order-id">
                    ã€è®¢å•ï¼š\${order.id}ã€‘
                    \${tags}
                </div>
                <button class="copy-btn" data-copy="\${order.id}">å¤åˆ¶æœ¬å•</button>
            </div>
            
            <div class="order-content">
                <div class="order-item">
                    <span class="order-label">å®¶é•¿ç§°å‘¼ï¼š</span>
                    <span class="order-value">\${order.parentName || 'æœªå¡«å†™'}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">å­©å­å¹´çº§ï¼š</span>
                    <span class="order-value">\${order.grade}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">ç§‘ç›®ï¼š</span>
                    <span class="order-value">\${order.subject}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">æˆç»©ï¼š</span>
                    <span class="order-value">\${order.score}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">å­©å­æ€§åˆ«ï¼š</span>
                    <span class="order-value">\${order.studentGender}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">è¯¾é…¬ï¼š</span>
                    <span class="order-value order-salary">\${order.salary}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">è€å¸ˆæ€§åˆ«ï¼š</span>
                    <span class="order-value">\${order.teacherGender}</span>
                </div>
                
                <div class="order-item">
                    <span class="order-label">æ¬¡æ•°ï¼š</span>
                    <span class="order-value">\${order.frequency}</span>
                </div>
                
                <div class="order-address">
                    <div class="order-item">
                        <span class="order-label">ä¸Šé—¨åœ°å€ï¼š</span>
                        <span class="order-value">\${order.address}</span>
                        <button class="copy-address" data-copy-address="\${order.address}">å¤åˆ¶åœ°å€</button>
                    </div>
                </div>
                
                <div class="order-item">
                    <span class="order-label">è¾…å¯¼æ—¶é—´ï¼š</span>
                    <span class="order-value">\${order.time}</span>
                </div>
                
                <div class="order-requirements">
                    <strong>å¯¹è€å¸ˆçš„è¦æ±‚ï¼š</strong>\${order.requirements}
                </div>
            </div>
        </div>
    \`;
}

// è·å–è®¢å•æ ‡ç­¾
function getOrderTags(order) {
    let tags = '';
    
    if (order.category.includes('urgent')) {
        tags += '<span class="order-tag urgent">åŠ æ€¥</span>';
    }
    if (order.category.includes('high-price')) {
        tags += '<span class="order-tag high-price">é«˜ä»·</span>';
    }
    if (order.category.includes('summer')) {
        tags += '<span class="order-tag summer">æš‘å‡å•</span>';
    }
    if (order.category.includes('weekend')) {
        tags += '<span class="order-tag weekend">å‘¨æœ«</span>';
    }
    if (order.category.includes('evening')) {
        tags += '<span class="order-tag evening">æ™šä¸Š</span>';
    }
    if (order.category.includes('daily')) {
        tags += '<span class="order-tag daily">æ—¥å¸¸</span>';
    }
    
    return tags;
}

// ç­›é€‰è®¢å•
function filterOrders() {
    const region = regionFilter.value.toLowerCase();
    const grade = gradeFilter.value.toLowerCase();
    const subject = subjectFilter.value.toLowerCase();
    const searchTerm = orderSearch.value.toLowerCase();
    
    filteredData = orderData.filter(order => {
        // åœ°åŒºç­›é€‰
        if (region && !order.region.toLowerCase().includes(region)) {
            return false;
        }
        
        // å¹´çº§ç­›é€‰
        if (grade && !order.grade.toLowerCase().includes(grade)) {
            return false;
        }
        
        // ç§‘ç›®ç­›é€‰
        if (subject && !order.subject.toLowerCase().includes(subject)) {
            return false;
        }
        
        // æœç´¢ç­›é€‰
        if (searchTerm && !order.id.toLowerCase().includes(searchTerm)) {
            return false;
        }
        
        // åˆ†ç±»ç­›é€‰
        if (currentCategory !== 'all' && !order.category.includes(currentCategory)) {
            return false;
        }
        
        return true;
    });
    
    renderOrders(filteredData);
}

// ç»‘å®šå¤åˆ¶äº‹ä»¶
function bindCopyEvents() {
    // å¤åˆ¶è®¢å•æŒ‰é’®
    const copyBtns = document.querySelectorAll('[data-copy]');
    copyBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const orderId = this.dataset.copy;
            const order = orderData.find(o => o.id === orderId);
            if (order) {
                const orderText = formatOrderForCopy(order);
                copyToClipboard(orderText, 'è®¢å•ä¿¡æ¯å·²å¤åˆ¶');
            }
        });
    });
    
    // å¤åˆ¶åœ°å€æŒ‰é’®
    const copyAddressBtns = document.querySelectorAll('[data-copy-address]');
    copyAddressBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const address = this.dataset.copyAddress;
            copyToClipboard(address, 'åœ°å€å·²å¤åˆ¶');
        });
    });
}

// æ ¼å¼åŒ–è®¢å•ç”¨äºå¤åˆ¶
function formatOrderForCopy(order) {
    return \`ã€è®¢å•ï¼š\${order.id}ã€‘
å®¶é•¿ç§°å‘¼ï¼š\${order.parentName || ''}
å­©å­å¹´çº§ï¼š\${order.grade}
ç§‘ç›®ï¼š\${order.subject}
æˆç»©ï¼š\${order.score}
å­©å­æ€§åˆ«ï¼š\${order.studentGender}
è¯¾é…¬ï¼š\${order.salary}
è€å¸ˆæ€§åˆ«ï¼š\${order.teacherGender}
å¯¹è€å¸ˆçš„è¦æ±‚ï¼š\${order.requirements}
æ¬¡æ•°ï¼š\${order.frequency}
è¾…å¯¼æ—¶é—´ï¼š\${order.time}
ä¸Šé—¨åœ°å€ï¼š\${order.address}\`;
}

// å¤åˆ¶åˆ°å‰ªè´´æ¿
function copyToClipboard(text, message = 'å·²å¤åˆ¶') {
    if (navigator.clipboard && window.isSecureContext) {
        // ç°ä»£æµè§ˆå™¨æ”¯æŒ
        navigator.clipboard.writeText(text).then(() => {
            showCopySuccess(message);
        }).catch(() => {
            fallbackCopy(text, message);
        });
    } else {
        // å…¼å®¹æ—§æµè§ˆå™¨
        fallbackCopy(text, message);
    }
}

// å…¼å®¹æ—§æµè§ˆå™¨çš„å¤åˆ¶æ–¹æ³•
function fallbackCopy(text, message) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        document.execCommand('copy');
        showCopySuccess(message);
    } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        showCopySuccess('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
    }
    
    document.body.removeChild(textArea);
}

// æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
function showCopySuccess(message) {
    // ç§»é™¤å·²å­˜åœ¨çš„æç¤º
    const existingToast = document.querySelector('.copy-success');
    if (existingToast) {
        existingToast.remove();
    }
    
    // åˆ›å»ºæ–°æç¤º
    const toast = document.createElement('div');
    toast.className = 'copy-success';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    // 2ç§’åè‡ªåŠ¨ç§»é™¤
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 2000);
}

// æœç´¢åŠŸèƒ½å¢å¼º
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–æœç´¢
orderSearch.addEventListener('input', debounce(filterOrders, 300));`;
        }
        
        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showMessage(message, type) {
            const container = document.getElementById('statusMessage');
            container.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            // 3ç§’åè‡ªåŠ¨æ¸…é™¤
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }
        
        // ç›‘å¬å›è½¦é”®ç™»å½•
        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>
</html>